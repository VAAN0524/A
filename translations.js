// 多语言配置文件
const translations = {
    zh: {
        // 页面标题
        pageTitle: "塔罗牌 - 他到底喜欢我吗？",

        // 导航和按钮
        home: "首页",
        history: "历史记录",
        favorites: "我的收藏",
        music: "音乐",
        backToHome: "返回首页",
        language: "中文/ENGLISH",

        // 主页
        mainTitle: "他到底喜欢我吗？",
        mainSubtitle: "塔罗牌帮你探寻爱情的答案，一键解读你的心意",
        startDivination: "开始占卜",
        learnTarot: "了解塔罗",

        // 统计数据
        usersTrust: "万+ 用户信赖",
        accuracy: "% 准确率",
        onlineService: "小时 在线服务",
        dailyReadings: "+ 每日解读",

        // 问题类型选择
        selectQuestionType: "请选择你的问题类型",
        selectQuestionDesc: "选择一个与你内心困惑最相关的问题类型",
        loveDivination: "爱情占卜",
        loveDivinationDesc: "探索感情的真谛",
        popularChoice: "热门选择",
        careerDevelopment: "事业发展",
        careerDevelopmentDesc: "指引职业方向",
        careerAdvice: "职场建议",
        relationships: "人际关系",
        relationshipsDesc: "分析社交状况",
        socialGuidance: "社交指导",
        personalGrowth: "个人成长",
        personalGrowthDesc: "探索内在潜能",
        selfImprovement: "自我提升",
        dailyFortune: "日常运势",
        dailyFortuneDesc: "今日能量指引",
        dailyMustSee: "每日必看",
        customQuestion: "自定义问题",
        customQuestionDesc: "提出你的问题",
        personalized: "个性化",
        tips: "💡 小贴士",
        tipsDesc: "选择与当前困扰最相关的问题类型，这样塔罗牌的指引会更加精准和有针对性。",

        // 自定义问题输入
        enterYourQuestion: "请输入你的问题",
        questionPlaceholder: "请详细描述你的问题，例如：\n• 我和他之间的感情是否还有发展的可能？\n• 最近工作遇到了瓶颈，我该如何突破？\n• 我该如何平衡家庭和工作的关系？",
        questionMinLength: "最少5个字符，最多200个字符",
        loveQuestions: "感情问题示例",
        careerQuestions: "事业问题示例",
        yourQuestion: "你的问题",
        backToSelection: "返回选择",
        confirmQuestion: "确认问题",

        // 抽牌界面
        diviningFor: "正在为\"{question}\"进行塔罗占卜...",
        diviningProgress: "占卜进度",
        clickToDraw: "点击抽牌",
        drawComplete: "抽牌完成",
        threeCardsComplete: "✨ 3张牌已抽完，点击开始解读查看结果！",
        startReading: "开始解读",
        clickToView: "点击查看塔罗牌的指引",

        // 牌面位置
        past: "过去",
        present: "现在",
        future: "未来",

        // 解读结果
        readingResults: "塔罗解读结果",
        deepTarotReading: "深度塔罗解读",
        pastSituation: "过去的情况",
        currentState: "现在的状态",
        futureDevelopment: "未来的发展",
        overallSpread: "整体牌阵",
        energyInsights: "综合能量洞察",
        personalizedGuidance: "个性化指导方案",
        coreGuidance: "核心指引",
        additionalAdvice: "辅助建议",
        spiritualPractice: "灵性修行",
        actionPlan: "行动计划",
        todaysAffirmation: "今日肯定语",
        timeEnergyPrediction: "时间能量预测",
        energyCycle: "能量周期",
        positive: "积极向上",
        possibility: "可能性",
        likelihood: "较高",
        timeFrame: "时间框架",
        shortTerm: "短期（1-3个月）",
        mediumTerm: "中期（3-6个月）",
        longTerm: "长期（6个月以上）",
        bestTimeToAct: "现在是行动的最佳时机，抓住这个能量高峰期",
        keyFactors: "关键影响因素",

        // 指数显示
        smoothnessIndex: "顺利指数",
        moodIndex: "情绪指数",

        // 操作按钮
        shareResult: "分享结果",
        saveResult: "保存结果",
        addToFavorites: "添加收藏",
        newDivination: "重新占卜",

        // 消息提示
        tarotIsChoosing: "塔罗牌正在选择你...",
        pleaseWait: "请稍候，神秘的指引正在显现...",
        cardsSelected: "已经选择了{count}张牌",
        readingCompleted: "解读完成！",
        savedToFavorites: "已添加到收藏",
        removedFromFavorites: "已从收藏中移除",
        resultSaved: "结果已保存",
        shareCopied: "分享链接已复制到剪贴板",
        questionSelected: "已选择：{question}",

        // 其他
        loading: "加载中...",
        error: "错误",
        success: "成功",
        cancel: "取消",
        confirm: "确认"
    },

    en: {
        // Page titles
        pageTitle: "Tarot Cards - Does He Really Like Me?",

        // Navigation and buttons
        home: "Home",
        history: "History",
        favorites: "My Favorites",
        music: "Music",
        backToHome: "Back to Home",
        language: "中文/ENGLISH",

        // Homepage
        mainTitle: "Does He Really Like Me?",
        mainSubtitle: "Tarot cards help you explore the answers to love, one-click interpretation of your heart",
        startDivination: "Start Divination",
        learnTarot: "Learn Tarot",

        // Statistics
        usersTrust: "100K+ Users Trust",
        accuracy: "% Accuracy Rate",
        onlineService: "Hours Online Service",
        dailyReadings: "+ Daily Readings",

        // Question type selection
        selectQuestionType: "Please Select Your Question Type",
        selectQuestionDesc: "Choose a question type that best relates to your current concerns",
        loveDivination: "Love Divination",
        loveDivinationDesc: "Explore the truth of relationships",
        popularChoice: "Popular Choice",
        careerDevelopment: "Career Development",
        careerDevelopmentDesc: "Guide your career direction",
        careerAdvice: "Career Advice",
        relationships: "Relationships",
        relationshipsDesc: "Analyze social situations",
        socialGuidance: "Social Guidance",
        personalGrowth: "Personal Growth",
        personalGrowthDesc: "Explore inner potential",
        selfImprovement: "Self Improvement",
        dailyFortune: "Daily Fortune",
        dailyFortuneDesc: "Today's energy guidance",
        dailyMustSee: "Daily Must-See",
        customQuestion: "Custom Question",
        customQuestionDesc: "Ask your question",
        personalized: "Personalized",
        tips: "💡 Tips",
        tipsDesc: "Choose a question type that relates to your current concerns, so the tarot guidance will be more precise and targeted.",

        // Custom question input
        enterYourQuestion: "Enter Your Question",
        questionPlaceholder: "Please describe your question in detail, for example:\n• Is there still potential for development in our relationship?\n• I've encountered a bottleneck at work recently, how can I break through?\n• How should I balance family and work relationships?",
        questionMinLength: "Minimum 5 characters, maximum 200 characters",
        loveQuestions: "Love Question Examples",
        careerQuestions: "Career Question Examples",
        yourQuestion: "Your Question",
        backToSelection: "Back to Selection",
        confirmQuestion: "Confirm Question",

        // Card drawing interface
        diviningFor: "Performing tarot divination for \"{question}\"...",
        diviningProgress: "Divination Progress",
        clickToDraw: "Click to Draw",
        drawComplete: "Drawing Complete",
        threeCardsComplete: "✨ 3 cards drawn, click start reading to view results!",
        startReading: "Start Reading",
        clickToView: "Click to view tarot guidance",

        // Card positions
        past: "Past",
        present: "Present",
        future: "Future",

        // Reading results
        readingResults: "Tarot Reading Results",
        deepTarotReading: "Deep Tarot Reading",
        pastSituation: "Past Situation",
        currentState: "Current State",
        futureDevelopment: "Future Development",
        overallSpread: "Overall Spread",
        energyInsights: "Energy Insights",
        personalizedGuidance: "Personalized Guidance Plan",
        coreGuidance: "Core Guidance",
        additionalAdvice: "Additional Advice",
        spiritualPractice: "Spiritual Practice",
        actionPlan: "Action Plan",
        todaysAffirmation: "Today's Affirmation",
        timeEnergyPrediction: "Time Energy Prediction",
        energyCycle: "Energy Cycle",
        positive: "Positive",
        possibility: "Possibility",
        likelihood: "High",
        timeFrame: "Time Frame",
        shortTerm: "Short-term (1-3 months)",
        mediumTerm: "Medium-term (3-6 months)",
        longTerm: "Long-term (6+ months)",
        bestTimeToAct: "Now is the best time to act, seize this energy peak",
        keyFactors: "Key Influencing Factors",

        // Index display
        smoothnessIndex: "Smoothness Index",
        moodIndex: "Mood Index",

        // Action buttons
        shareResult: "Share Result",
        saveResult: "Save Result",
        addToFavorites: "Add to Favorites",
        newDivination: "New Divination",

        // Message prompts
        tarotIsChoosing: "Tarot cards are choosing you...",
        pleaseWait: "Please wait, the mysterious guidance is manifesting...",
        cardsSelected: "Already selected {count} cards",
        readingCompleted: "Reading completed!",
        savedToFavorites: "Added to favorites",
        removedFromFavorites: "Removed from favorites",
        resultSaved: "Result saved",
        shareCopied: "Share link copied to clipboard",
        questionSelected: "Selected: {question}",

        // Others
        loading: "Loading...",
        error: "Error",
        success: "Success",
        cancel: "Cancel",
        confirm: "Confirm"
    }
};

// 默认语言
let currentLanguage = 'zh';

// 获取翻译文本的函数
function t(key, params = {}) {
    const keys = key.split('.');
    let value = translations[currentLanguage];

    for (const k of keys) {
        value = value?.[k];
    }

    if (value === undefined) {
        // 如果当前语言没有找到，尝试使用中文作为后备
        value = translations.zh;
        for (const k of keys) {
            value = value?.[k];
        }
    }

    // 处理参数替换
    if (value && typeof value === 'string' && Object.keys(params).length > 0) {
        Object.keys(params).forEach(param => {
            value = value.replace(`{${param}}`, params[param]);
        });
    }

    return value || key;
}

// 切换语言的函数
function switchLanguage(lang) {
    if (translations[lang]) {
        currentLanguage = lang;
        localStorage.setItem('preferredLanguage', lang);
        updateAllTexts();
        updateHTMLAttributes();
    }
}

// 更新页面所有文本
function updateAllTexts() {
    // 更新页面标题
    document.title = t('pageTitle');

    // 更新带有data-i18n属性的元素
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        element.textContent = t(key);
    });

    // 更新带有data-i18n-placeholder属性的元素
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        element.placeholder = t(key);
    });

    // 更新带有data-i18n-title属性的元素
    document.querySelectorAll('[data-i18n-title]').forEach(element => {
        const key = element.getAttribute('data-i18n-title');
        element.title = t(key);
    });

    // 更新带有data-i18n-alt属性的元素
    document.querySelectorAll('[data-i18n-alt]').forEach(element => {
        const key = element.getAttribute('data-i18n-alt');
        element.alt = t(key);
    });
}

// 更新HTML语言属性
function updateHTMLAttributes() {
    document.documentElement.lang = currentLanguage === 'zh' ? 'zh-CN' : 'en';
}

// 初始化语言设置
function initializeLanguage() {
    const savedLanguage = localStorage.getItem('preferredLanguage') || 'zh';
    currentLanguage = savedLanguage;
    updateAllTexts();
    updateHTMLAttributes();

    // 更新语言切换按钮状态
    const langButton = document.getElementById('languageToggle');
    if (langButton) {
        langButton.textContent = t('language');
    }
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', initializeLanguage);